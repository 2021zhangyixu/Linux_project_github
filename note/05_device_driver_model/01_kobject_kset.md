# 设备模型基础概念

## 为什么要引入设备模型

1. 因为 **`Linux` 具有普适性**，支持世界上几乎所有的、不同功能的硬件设备，从而**导致 `Linux` 内核中一半的代码是设备驱动**。随着**硬件的快速迭代，设备驱动的代码量也将快速增长，最终导致 `Linux` 内核臃肿、杂乱、不易维护**。
2. 为了降低设备的多样性带来的 `Linux` 驱动开发复杂性，`Linux` 内核提出了设备模型（`driver Model`）的概念。设备模型（`driver Model`）具有如下优点 :
   - **代码复用性** : 设备模型（`driver Model`）将硬件归纳、分类，然后**抽象出一套标准的数据结构和接口**。这样**驱动开发就能够简化为对 `Linux` 内核的数据结构体填充和实现**。**多个设备也能够复用同一个驱动**，有效的降低了代码的冗余，提高驱动的复用性和可维护性。
   - **资源的动态申请和释放（热插拔）** : 在 `Linux` 中，**只要有任何的 `device` 和`device_driver` 具有相同的名字，那么就会触发 `device_driver` 中的 `probe` 函数**。在该函数中，将会初始化设备，使其变成可用状态。**对于大多数热插拔设备，当设备没有插入，其 `device` 结构体不存在，但 `device_driver` 一直存在**。当设备插入，内核自动创建一个 `device` 结构体（名字与 `device_driver` 相同）此时将会触发 `device_driver` 的 `probe` 函数。
   - **简化驱动程序编写** : **当系统中设备非常多，依赖关系负载的时候，无论是内核还是驱动开发人员，都无力维护这种关系**。设备模型的树状关系可用自动处理这种依赖关系。启动某一个设备前，内核会检查该设备是否存在依赖，如果有，将会检查依赖是否启动。如果没有就启动他们，以此类推，最终达到启动该设备的条件为止。这样**驱动开发人员要做的就是，告诉内核该设备的依赖关系**。
   - **驱动的面向对象思想** : 在设备模型中引入了面向对象的概念。**每个设备被看作是一个对象，具有自己的属性和方法，并且可用通过设备模型进行继承和扩展。这样能够使得驱动更加模块化，更好的应对不同类型的设备和功能。**

## Kobject 与 Kset

1. `Kobject` (内核对象)，是内核中抽象出来的**通用对象模型**，用于**表示内核中的各种实体**。
2. 每一个 `kobject` 都会在对应的 `/sys/` 目录下创建一个目录。
3. 一个 `kobject` 可以**一个父  `kobject`  和多个子  `kobject` ** 。
4. `kset` 是 `kobject` 的一种扩展，它可以将一组  `kobject` 组织在一起，用于组织和管理  `kobject`  集合。 **一个 `kset` 可以包含多个  `kobject` ，而一个  `kobject`  只能属于一个 `kset`** 。